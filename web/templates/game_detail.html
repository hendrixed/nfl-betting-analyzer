{% extends "base.html" %}

{% block title %}Game Details - {{ game.away_team }} @ {{ game.home_team }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Home</a></li>
                <li class="breadcrumb-item"><a href="/games">Games</a></li>
                <li class="breadcrumb-item active">{{ game.game_id }}</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <div class="card prediction-card text-white">
            <div class="card-body text-center">
                <h1 class="card-title mb-3">
                    <span class="team-name">{{ game.away_team }}</span>
                    <span class="mx-3">@</span>
                    <span class="team-name">{{ game.home_team }}</span>
                </h1>
                <div class="row">
                    <div class="col-md-4">
                        <h6>Game Date</h6>
                        <p class="mb-0">{{ game.game_date.strftime('%A, %B %d, %Y') if game.game_date else 'TBD' }}</p>
                        <small>{{ game.game_date.strftime('%I:%M %p') if game.game_date else '' }}</small>
                    </div>
                    <div class="col-md-4">
                        <h6>Week {{ game.week }}</h6>
                        <p class="mb-0">{{ game.season }} Season</p>
                    </div>
                    <div class="col-md-4">
                        <h6>Game ID</h6>
                        <p class="mb-0"><code>{{ game.game_id }}</code></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% if prediction %}
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-chart-line"></i> Score Prediction</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <h3 class="text-primary">{{ game.away_team }}</h3>
                        <h1 class="game-score">{{ prediction.game_info.away_score|round|int }}</h1>
                    </div>
                    <div class="col-6">
                        <h3 class="text-success">{{ game.home_team }}</h3>
                        <h1 class="game-score">{{ prediction.game_info.home_score|round|int }}</h1>
                    </div>
                </div>
                <hr>
                <div class="row text-center">
                    <div class="col-4">
                        <small class="text-muted">Total Points</small>
                        <div class="fw-bold">{{ prediction.game_info.total_points|round|int }}</div>
                    </div>
                    <div class="col-4">
                        <small class="text-muted">Spread</small>
                        <div class="fw-bold">{{ game.home_team }} {{ prediction.game_info.spread|round(1) }}</div>
                    </div>
                    <div class="col-4">
                        <small class="text-muted">Confidence</small>
                        <div class="fw-bold confidence-{{ 'high' if prediction.game_info.score_confidence > 0.7 else 'medium' if prediction.game_info.score_confidence > 0.5 else 'low' }}">
                            {{ (prediction.game_info.score_confidence * 100)|round|int }}%
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-football-ball"></i> Game Totals</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Passing Yards</span>
                        <span class="fw-bold">{{ prediction.total_passing_yards|round|int }}</span>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Rushing Yards</span>
                        <span class="fw-bold">{{ prediction.total_rushing_yards|round|int }}</span>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Total Touchdowns</span>
                        <span class="fw-bold">{{ prediction.total_touchdowns|round|int }}</span>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <span>Game Script</span>
                        <span class="fw-bold">{{ prediction.game_info.game_script|title }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-star"></i> Top Fantasy Performers</h5>
            </div>
            <div class="card-body">
                <div class="row">
                {% for name, points in prediction.top_fantasy_performers[:6] %}
                    <div class="col-md-4 mb-3">
                        <div class="d-flex justify-content-between align-items-center p-2 border rounded">
                            <span class="fw-bold">{{ name }}</span>
                            <span class="badge bg-primary">{{ points|round(1) }} pts</span>
                        </div>
                    </div>
                {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

{% if prediction.top_passing_yards or prediction.top_rushing_yards or prediction.top_receiving_yards %}
<div class="row mb-4">
    <div class="col-md-4">
        {% if prediction.top_passing_yards %}
        <div class="card">
            <div class="card-header">
                <h6><i class="fas fa-paper-plane"></i> Passing Leaders</h6>
            </div>
            <div class="card-body">
                {% for name, yards in prediction.top_passing_yards[:3] %}
                <div class="d-flex justify-content-between mb-2">
                    <span>{{ name }}</span>
                    <span class="fw-bold">{{ yards|round|int }} yds</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    
    <div class="col-md-4">
        {% if prediction.top_rushing_yards %}
        <div class="card">
            <div class="card-header">
                <h6><i class="fas fa-running"></i> Rushing Leaders</h6>
            </div>
            <div class="card-body">
                {% for name, yards in prediction.top_rushing_yards[:3] %}
                <div class="d-flex justify-content-between mb-2">
                    <span>{{ name }}</span>
                    <span class="fw-bold">{{ yards|round|int }} yds</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    
    <div class="col-md-4">
        {% if prediction.top_receiving_yards %}
        <div class="card">
            <div class="card-header">
                <h6><i class="fas fa-hands-catching"></i> Receiving Leaders</h6>
            </div>
            <div class="card-body">
                {% for name, yards in prediction.top_receiving_yards[:3] %}
                <div class="d-flex justify-content-between mb-2">
                    <span>{{ name }}</span>
                    <span class="fw-bold">{{ yards|round|int }} yds</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

{% if leaders %}
<div class="row mb-4">
  <div class="col-md-4">
    <div class="card">
      <div class="card-header"><h6 class="mb-0"><i class="fas fa-paper-plane"></i> Passing Leaders (DB)</h6></div>
      <div class="card-body">
        {% for l in leaders.passing_yards %}
        <div class="d-flex justify-content-between mb-2">
          <span><a href="/player/{{ l.player_id }}">{{ l.name }}</a> ({{ l.team }})</span>
          <span class="fw-bold">{{ l.value|round|int }} yds</span>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card">
      <div class="card-header"><h6 class="mb-0"><i class="fas fa-running"></i> Rushing Leaders (DB)</h6></div>
      <div class="card-body">
        {% for l in leaders.rushing_yards %}
        <div class="d-flex justify-content-between mb-2">
          <span><a href="/player/{{ l.player_id }}">{{ l.name }}</a> ({{ l.team }})</span>
          <span class="fw-bold">{{ l.value|round|int }} yds</span>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card">
      <div class="card-header"><h6 class="mb-0"><i class="fas fa-hands"></i> Receiving Leaders (DB)</h6></div>
      <div class="card-body">
        {% for l in leaders.receiving_yards %}
        <div class="d-flex justify-content-between mb-2">
          <span><a href="/player/{{ l.player_id }}">{{ l.name }}</a> ({{ l.team }})</span>
          <span class="fw-bold">{{ l.value|round|int }} yds</span>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  </div>
{% endif %}

{% if offers %}
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header"><h6 class="mb-0"><i class="fas fa-coins"></i> Odds Summary</h6></div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead>
              <tr>
                <th>Book</th>
                <th>Market</th>
                <th>Team</th>
                <th class="text-end">Line</th>
                <th class="text-end">Over</th>
                <th class="text-end">Under</th>
              </tr>
            </thead>
            <tbody>
              {% for o in offers %}
              <tr>
                <td>{{ o.book }}</td>
                <td>{{ o.market }}</td>
                <td>{{ o.team_id }}</td>
                <td class="text-end">{{ o.line }}</td>
                <td class="text-end">{{ o.over_odds }}</td>
                <td class="text-end">{{ o.under_odds }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}

{% else %}
<div class="row mb-4">
    <div class="col-12">
        <div class="alert alert-info text-center">
            <h4><i class="fas fa-info-circle"></i> No Prediction Available</h4>
            <p>Game prediction is not yet available for this matchup.</p>
            <a href="/api/game/{{ game.game_id }}/prediction" class="btn btn-primary">Generate Prediction</a>
        </div>
    </div>
</div>
{% endif %}

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-users"></i> {{ game.away_team }} Roster</h5>
            </div>
            <div class="card-body">
                <a href="/team/{{ game.away_team }}" class="btn btn-outline-primary w-100">
                    View {{ game.away_team }} Players
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-users"></i> {{ game.home_team }} Roster</h5>
            </div>
            <div class="card-body">
                <a href="/team/{{ game.home_team }}" class="btn btn-outline-success w-100">
                    View {{ game.home_team }} Players
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-tools"></i> Game Actions</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <a href="/api/game/{{ game.game_id }}/prediction" class="btn btn-primary w-100 mb-2">
                            <i class="fas fa-sync"></i> Refresh Prediction
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="/predictions?away_team={{ game.away_team }}&home_team={{ game.home_team }}" class="btn btn-outline-info w-100 mb-2">
                            <i class="fas fa-chart-bar"></i> Player Props
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="/games" class="btn btn-outline-secondary w-100 mb-2">
                            <i class="fas fa-list"></i> All Games
                        </a>
                    </div>
                    <div class="col-md-3">
                        <a href="/" class="btn btn-outline-dark w-100 mb-2">
                            <i class="fas fa-home"></i> Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
